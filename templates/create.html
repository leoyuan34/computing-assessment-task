{% extends "base.html" %}
{% block title %}Create - Transit Travel Forum{% endblock %}
{% block content %}

<div class="create-container">
  <div class="create-header">
    <h1>My Posts</h1>
    <button class="btn-create" onclick="toggleCreateForm()">
      <i class="fa-solid fa-plus"></i> Create Post
    </button>
  </div>

  <!-- Success/Error Messages -->
  {% if success %}
  <div class="message success-message">
    <i class="fa-solid fa-circle-check"></i> {{ success }}
  </div>
  {% endif %}

  {% if error %}
  <div class="message error-message">
    <i class="fa-solid fa-circle-exclamation"></i> {{ error }}
  </div>
  {% endif %}

  <!-- Create Post Form (Hidden by default) -->
  <div id="createForm" class="create-form-container" style="display: none;">
    <div class="create-form-card">
      <div class="form-header">
        <h2>Create New Post</h2>
        <button class="close-btn" onclick="toggleCreateForm()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      
      <form method="POST" action="{{ url_for('create_post') }}" enctype="multipart/form-data">
        <div class="form-group">
          <label for="title">Post Title</label>
          <input type="text" id="title" name="title" placeholder="Give your post a title..." required>
        </div>

        <div class="form-group">
          <label for="content">Content</label>
          <textarea id="content" name="content" rows="6" placeholder="Share your travel experience..." required></textarea>
        </div>

        <div class="form-group">
          <label for="image">Image (Optional)</label>
          <input type="file" id="image" name="image" accept="image/*">
          <small>Upload a photo from your travels</small>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="toggleCreateForm()">Cancel</button>
          <button type="submit" class="btn-submit">
            <i class="fa-solid fa-paper-plane"></i> Post
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Posts List -->
  <div class="posts-list">
    {% if posts %}
      {% for post in posts %}
      <div class="post-card">
        <div class="post-header">
          <div class="post-author">
            <img src="{{ url_for('static', filename='images/profile.png') }}" alt="Profile">
            <div>
              <h3>{{ post['username'] }}</h3>
              <span class="post-date">{{ post['created_at'] }}</span>
            </div>
          </div>
          <form method="POST" action="{{ url_for('delete_post', post_id=post['id']) }}" style="display: inline;">
            <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this post?')">
              <i class="fa-solid fa-trash"></i>
            </button>
          </form>
        </div>

        <div class="post-content">
          <h2>{{ post['title'] }}</h2>
          {% if post['image_path'] %}
          <img src="{{ url_for('static', filename=post['image_path']) }}" alt="Post image" class="post-image">
          {% endif %}
          <p>{{ post['content'] }}</p>
        </div>

        <div class="post-actions">
          <button class="action-btn">
            <i class="fa-solid fa-heart"></i> Like
          </button>
          <button class="action-btn">
            <i class="fa-solid fa-comment"></i> Comment
          </button>
          <button class="action-btn">
            <i class="fa-solid fa-share"></i> Share
          </button>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <i class="fa-solid fa-image"></i>
        <h2>No posts yet</h2>
        <p>Click "Create Post" to share your first travel experience!</p>
      </div>
    {% endif %}
  </div>
</div>

<script>
function toggleCreateForm() {
  const form = document.getElementById('createForm');
  if (form.style.display === 'none') {
    form.style.display = 'flex';
  } else {
    form.style.display = 'none';
  }
}
</script>

{% endblock %}